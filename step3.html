<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Order Confirmation</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    max-width: 400px;
  }
  .container {
    border: 1px solid #000;
    padding: 10px;
  }
  p {
    font-size: 0.9rem;
    margin: 5px 0;
  }
  label.checkbox-label {
    display: flex;
    align-items: center;
    margin: 10px 0 10px 0;
    font-size: 0.9rem;
  }
  label.checkbox-label input {
    margin-right: 8px;
  }
  input[type="text"] {
    width: 100%;
    box-sizing: border-box;
    padding: 6px;
    margin: 4px 0 10px 0;
    border: 1px solid #000;
    font-size: 1rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 10px;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid #000;
    padding: 4px 6px;
    text-align: center;
  }
  th {
    font-weight: bold;
  }
  .right-align {
    text-align: right;
    padding-right: 6px;
    font-weight: bold;
  }
  input.discount-input {
    width: 40px;
    border: none;
    border-bottom: 1px solid red;
    color: red;
    text-align: right;
    font-weight: bold;
    font-size: 0.9rem;
  }
  button {
    width: 100%;
    padding: 10px;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #000;
    background-color: #eee;
  }
  button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }
  .error-msg {
    color: red;
    font-size: 0.85rem;
    margin-top: -8px;
    margin-bottom: 8px;
    display: none;
  }
</style>
</head>
<body>
  <div class="container">
    <p>please make sure all data is right.<br />
    your order is going to be final.<br /></p>
    <label class="checkbox-label">
      <input type="checkbox" id="confirmCheck" />
       I know that all data i included are right as i know.
    </label>

    <label for="nameInput">name</label>
    <input type="text" id="nameInput" name="name" autocomplete="name" required />

    <label for="contactInput">contact</label>
    <input type="text" id="contactInput" name="contact" autocomplete="tel" required />

    <table aria-label="Order items table">
      <thead>
        <tr>
          <th>ITEMS</th>
          <th>QUANTITY</th>
          <th>TOTAL</th>
        </tr>
      </thead>
      <tbody id="itemsBody">
        <!-- example rows -->
        <tr>
          <td contenteditable="true" aria-label="Item name">Example item</td>
          <td contenteditable="true" aria-label="Quantity">1</td>
          <td contenteditable="true" aria-label="Total">10.00</td>
        </tr>
        <tr>
          <td contenteditable="true" aria-label="Item name">Example item 2</td>
          <td contenteditable="true" aria-label="Quantity">2</td>
          <td contenteditable="true" aria-label="Total">20.00</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td class="right-align" colspan="2">GRAND TOTAL</td>
          <td id="grandTotal" aria-live="polite">0.00</td>
        </tr>
        <tr>
          <td class="right-align" colspan="2" style="color:red;">DISCOUNT</td>
          <td>
            <div
              type="number"
              id="discountInput"
              class="discount-input"
              aria-label="Discount percentage"
              min="0"
              max="100"
              step="1"
              value="0"
            > %</div>
          </td>
        </tr>
        <tr>
          <td class="right-align" colspan="2">TOTAL PAYABLE</td>
          <td id="totalPayable" aria-live="polite">0.00</td>
        </tr>
      </tfoot>
    </table>

    <div class="error-msg" id="errorMsg">Please check the checkbox and fill in required fields.</div>

    <button id="finishBtn" disabled>finish</button>
    <a href="step2.html">previous</a>
  </div>

<script>
  const finishBtn = document.getElementById('finishBtn');
  const confirmCheck = document.getElementById('confirmCheck');
  const nameInput = document.getElementById('nameInput');
  const contactInput = document.getElementById('contactInput');
  const discountInput = document.getElementById('discountInput');
  const grandTotalElem = document.getElementById('grandTotal');
  const totalPayableElem = document.getElementById('totalPayable');
  const itemsBody = document.getElementById('itemsBody');
  const errorMsg = document.getElementById('errorMsg');

  // Mock backend data example with price per unit
  const backendItems = [
  ];

  // Load items dynamically from backend data
  function loadItemsFromBackend(items) {
    itemsBody.innerHTML = ''; // Clear existing rows
    items.forEach(({ item, quantity, price }) => {
      const row = document.createElement('tr');
      row.dataset.price = price; // store price per unit

      // Item cell (read-only)
      const tdItem = document.createElement('td');
      tdItem.textContent = item;

      // Quantity cell (editable)
      const tdQty = document.createElement('td');
      tdQty.contentEditable = "true";
      tdQty.setAttribute('aria-label', 'Quantity');
      tdQty.textContent = quantity;

      // Total cell (read-only)
      const tdTotal = document.createElement('td');
      tdTotal.textContent = `${(quantity * price).toFixed(2)}`;

      row.appendChild(tdItem);
      row.appendChild(tdQty);
      row.appendChild(tdTotal);

      itemsBody.appendChild(row);
    });

    calculateTotals();
  }

  // Enable finish button only if checkbox and required fields filled
  function updateFinishBtnState() {
    if (
      confirmCheck.checked &&
      nameInput.value.trim() !== '' &&
      contactInput.value.trim() !== ''
    ) {
      finishBtn.disabled = false;
      errorMsg.style.display = 'none';
    } else {
      finishBtn.disabled = true;
    }
  }

  // Calculate totals on input changes
  function calculateTotals() {
    let grandTotal = 0;
    [...itemsBody.rows].forEach(row => {
      const qtyCell = row.cells[1];
      const totalCell = row.cells[2];
      const price = parseFloat(row.dataset.price) || 0;

      let qty = parseFloat(qtyCell.textContent);
      if (isNaN(qty) || qty < 0) qty = 0;

      // Update total for the row based on price * qty
      const rowTotal = qty * price;
      totalCell.textContent = `${rowTotal.toFixed(2)}`;

      grandTotal += rowTotal;
    });

    grandTotalElem.textContent = `${grandTotal.toFixed(2)}`;

    // Discount and total payable
    let discountPercent = parseFloat(discountInput.value);
    if (isNaN(discountPercent) || discountPercent < 0) discountPercent = 0;
    if (discountPercent > 100) discountPercent = 100;

    const discountAmount = (discountPercent / 100) * grandTotal;
    const totalPayable = grandTotal - discountAmount;

    totalPayableElem.textContent = `${totalPayable.toFixed(2)}`;
  }

  // Event listeners for form inputs
  confirmCheck.addEventListener('change', updateFinishBtnState);
  nameInput.addEventListener('input', updateFinishBtnState);
  contactInput.addEventListener('input', updateFinishBtnState);

  discountInput.addEventListener('input', () => {
    if (discountInput.value < 0) discountInput.value = 0;
    if (discountInput.value > 100) discountInput.value = 100;
    calculateTotals();
  });

  // Only listen to edits on quantity cell to recalculate totals
  itemsBody.addEventListener('input', (event) => {
    // Ensure only quantity cells edits trigger calculation
    if (event.target && event.target.cellIndex === 1) {
      // Validate content: allow only numbers (optional, you can enhance)
      let val = event.target.textContent.trim();
      if (!/^\d*\.?\d*$/.test(val)) {
        event.target.textContent = val.replace(/[^\d.]/g, '');
      }
      calculateTotals();
    }
  });

  itemsBody.addEventListener('blur', calculateTotals, true);

  finishBtn.addEventListener('click', () => {
    if (!confirmCheck.checked || nameInput.value.trim() === '' || contactInput.value.trim() === '') {
      errorMsg.style.display = 'block';
      return;
    }
    errorMsg.style.display = 'none';
    alert('Order submitted! Thank you.');
    // You can add backend submission here
  });

  // On page load: load items & update state
  window.onload = function () {
    // Replace below with your real backend fetch
    loadItemsFromBackend(backendItems);
    updateFinishBtnState();
  };
</script>

</body>
</html>
    